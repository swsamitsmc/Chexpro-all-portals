version: '3.8'

services:
  candidate-backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    container_name: chexpro-candidate-api
    restart: unless-stopped
    ports:
      - "3004:3004"
    environment:
      NODE_ENV: development
      PORT: 3004
    env_file:
      - ./backend/.env
    volumes:
      - ./backend:/app
      - /app/node_modules
      - ./backend/uploads:/app/uploads
    depends_on:
      - redis
    networks:
      - chexpro-network

  candidate-worker:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    container_name: chexpro-candidate-worker
    restart: unless-stopped
    environment:
      NODE_ENV: development
    env_file:
      - ./backend/.env
    command: npm run worker
    volumes:
      - ./backend:/app
      - /app/node_modules
    depends_on:
      - redis
    networks:
      - chexpro-network

  redis:
    image: redis:7-alpine
    container_name: chexpro-candidate-redis
    restart: unless-stopped
    ports:
      - "6381:6379"
    volumes:
      - redis_candidate_data:/data
    networks:
      - chexpro-network

volumes:
  redis_candidate_data:

networks:
  chexpro-network:
    name: chexpro-network
    driver: bridge
